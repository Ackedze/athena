{
  "version": 3,
  "sources": ["../src/ui.ts"],
  "sourcesContent": ["import type { DSComponent, DSExport } from './engine';\n\ntype ExportResultPayload = {\n  json: string;\n  data: DSExport;\n};\n\nconsole.log('[UI] script loaded');\n\n// \u041F\u043E\u0434\u043A\u043B\u044E\u0447\u0430\u0435\u043C UI controls \u0438 \u043E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0435\u043C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u043E\u0442 plugin controller.\nconst exportBtn = document.getElementById(\n  'export-btn',\n) as HTMLButtonElement | null;\nconst exportPageBtn = document.getElementById(\n  'export-page-btn',\n) as HTMLButtonElement | null;\nconst copyBtn = document.getElementById('copy-btn') as HTMLButtonElement | null;\nconst output = document.getElementById('output') as HTMLTextAreaElement | null;\nconst summaryMeta = document.getElementById(\n  'summary-meta',\n) as HTMLDivElement | null;\nconst platformSummary = document.getElementById(\n  'platform-summary',\n) as HTMLParagraphElement | null;\nconst statusSummary = document.getElementById(\n  'status-summary',\n) as HTMLParagraphElement | null;\nconst roleSummary = document.getElementById(\n  'role-summary',\n) as HTMLParagraphElement | null;\nconst componentTableBody = document.getElementById(\n  'component-table-body',\n) as HTMLTableSectionElement | null;\n\nconsole.log('[UI] elements:', {\n  exportBtn,\n  exportPageBtn,\n  copyBtn,\n  output,\n  summaryMeta,\n  platformSummary,\n  statusSummary,\n  roleSummary,\n  componentTableBody,\n});\n\nbindButton(exportBtn, () => {\n  console.log('[UI] export ALL button clicked \u2192 sending export-components');\n  parent.postMessage({ pluginMessage: { type: 'export-components' } }, '*');\n});\n\nbindButton(exportPageBtn, () => {\n  console.log(\n    '[UI] export CURRENT PAGE button clicked \u2192 sending export-components-current-page',\n  );\n  parent.postMessage(\n    { pluginMessage: { type: 'export-components-current-page' } },\n    '*',\n  );\n});\n\nbindButton(copyBtn, () => {\n  console.log('[UI] copy button clicked');\n  if (!output) return;\n\n  copyToClipboard(output.value)\n    .then(() => console.log('[UI] copied to clipboard'))\n    .catch((err) => console.error('[UI] failed to copy', err));\n});\n\nwindow.onmessage = (event: MessageEvent) => {\n  console.log('[UI] window.onmessage triggered:', event.data);\n\n  const msg = (event.data as { pluginMessage?: any }).pluginMessage;\n  if (!msg) return;\n\n  if (msg.type === 'echo') {\n    console.log('[UI] echo from code.ts:', msg);\n  }\n\n  if (msg.type === 'export-result') {\n    const payload = msg.payload as ExportResultPayload | undefined;\n    if (!payload) return;\n    renderExportResult(payload);\n  }\n};\n\nfunction bindButton(button: HTMLButtonElement | null, handler: () => void) {\n  if (!button) return;\n  button.onclick = handler;\n}\n\nfunction renderExportResult(payload: ExportResultPayload) {\n  if (output) {\n    output.value = payload.json;\n    console.log('[UI] textarea updated, length =', payload.json.length);\n  }\n\n  renderSummary(payload.data);\n  renderComponents(payload.data.components);\n}\n\nfunction renderSummary(data: DSExport) {\n  if (summaryMeta) {\n    summaryMeta.textContent = [\n      `\u041A\u043E\u043C\u043F\u043E\u043D\u0435\u043D\u0442\u044B: ${data.components.length}`,\n      `\u0421\u0442\u0440\u0430\u043D\u0438\u0446\u044B: ${data.meta.files.length || 0}`,\n      `\u0421\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E: ${new Date(data.meta.generatedAt).toLocaleString()}`,\n    ].join(' \u2022 ');\n  }\n\n  updateCounts(platformSummary, buildCountMap(data.components, 'platform'));\n  updateCounts(statusSummary, buildCountMap(data.components, 'status'));\n  updateCounts(roleSummary, buildCountMap(data.components, 'role'));\n}\n\nfunction renderComponents(components: DSComponent[]) {\n  if (!componentTableBody) return;\n\n  if (components.length === 0) {\n    componentTableBody.innerHTML =\n      '<tr><td colspan=\"5\">\u041D\u0435\u0442 \u043A\u043E\u043C\u043F\u043E\u043D\u0435\u043D\u0442\u043E\u0432</td></tr>';\n    return;\n  }\n\n  const rows = components.slice(0, 8).map((component) => {\n    const parentName =\n      component.parentComponent?.name?.trim() || '\u2014';\n    return `<tr>\n      <td>${component.name}</td>\n      <td>${component.platform}</td>\n      <td>${component.role}</td>\n      <td>${component.status}</td>\n      <td>${parentName}</td>\n    </tr>`;\n  });\n\n  componentTableBody.innerHTML = rows.join('');\n}\n\nfunction buildCountMap(\n  components: DSComponent[],\n  key: 'platform' | 'status' | 'role',\n): Record<string, number> {\n  return components.reduce<Record<string, number>>((acc, component) => {\n    const value = component[key];\n    acc[value] = (acc[value] ?? 0) + 1;\n    return acc;\n  }, {});\n}\n\nfunction updateCounts(\n  element: HTMLElement | null,\n  counts: Record<string, number>,\n) {\n  if (!element) return;\n  const entries = Object.entries(counts);\n  if (entries.length === 0) {\n    element.textContent = '\u2014';\n    return;\n  }\n\n  element.textContent = entries\n    .map(([name, count]) => `${name}: ${count}`)\n    .join(' \u2022 ');\n}\n\nfunction copyToClipboard(text: string): Promise<void> {\n  if (navigator.clipboard && navigator.clipboard.writeText) {\n    return navigator.clipboard.writeText(text);\n  }\n\n  return new Promise<void>((resolve, reject) => {\n    const textarea = document.createElement('textarea');\n    textarea.value = text;\n    document.body.appendChild(textarea);\n    textarea.select();\n\n    try {\n      document.execCommand('copy');\n      resolve();\n    } catch (error) {\n      reject(error);\n    } finally {\n      document.body.removeChild(textarea);\n    }\n  });\n}\n"],
  "mappings": "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",
  "names": []
}
